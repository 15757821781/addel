if("undefined"==typeof jQuery)throw new Error("addel requires jQuery");!function(t){"use strict";var e="addel",i=function(i,n){var s=this;this.$container=t(i),this.settings=t.extend(!0,{},t.fn[e].defaults,n),this.settings.formElements="input, select, textarea",["hide","add"].forEach(function(t){s.settings[t]=s.$container.data(e+"-"+t)||s.settings[t]}),["duration","easing"].forEach(function(t){s.settings.animation[t]=s.$container.data(e+"-animation-"+t)||s.settings.animation[t]}),this.selectors={},t.each(this.settings.classes,function(t,i){s.selectors[t]="."+i+", [data-"+e+"-"+t+"]"})};i.prototype={init:function(){this.settings.hide&&this.toggleTargetInputDisable(this.getLastTarget()).hide(),this.$container.on("click",this.selectors.add,{plugin:this},this.add).on("click",this.selectors["delete"],{plugin:this},this["delete"]).on("addel:add",this.settings.events.add).on("addel:added",this.settings.events.added).on("addel:delete",this.settings.events["delete"]).on("addel:deleted",this.settings.events.deleted)},add:function(i){var n=i.data.plugin,s=n.getLastTarget(),d=t(this).data(e+"-add")||n.settings.add;if(n.triggerAddEvent(s).isDefaultPrevented())return!1;var a=t();0===n.getVisibleTargetsCount()&&(d--,n.toggleTargetVisibility(s),a=a.add(s)),a=a.add(n.addTarget(s,d)),n.focusOnTargetInput(a),n.triggerAddedEvent(s,a)},addTarget:function(e,i){var n=t();e.finish();for(var s=0;i>s;s++){var d=e.clone();n=n.add(d),d.insertAfter(e).hide().fadeIn(this.settings.animation).find(this.settings.formElements).val(null)}return n},"delete":function(e){var i=e.data.plugin,n=t(this).closest(i.selectors.target);return i.triggerDeleteEvent(n).isDefaultPrevented()?!1:(1===i.getVisibleTargetsCount()?(i.toggleTargetVisibility(n),i.focusOnAdd()):(i.focusOnDelete(n),i.deleteTarget(n)),void i.triggerDeletedEvent(n))},deleteTarget:function(e){e.addClass("addel-deleting").fadeOut(this.settings.animation.duration,this.settings.animation.easing,function(){t(this).remove()})},toggleTargetVisibility:function(t){this.toggleTargetInputDisable(t).fadeToggle(this.settings.animation)},toggleTargetInputDisable:function(t){return t.find(this.settings.formElements).prop("disabled",function(t,e){return!e}),t},focusOnTargetInput:function(t){t.last().find(":input:enabled:visible:first").focus()},focusOnAdd:function(){this.$container.find(this.selectors.add).first().focus()},focusOnDelete:function(t){var e=t.prev(this.selectors.target).not(".addel-deleting"),i=t.next(this.selectors.target).not(".addel-deleting"),n=e.length?e:i;n.find(this.selectors["delete"]).focus()},getLastTarget:function(t){return this.$container.find(this.selectors.target).slice(-t||-1)},getVisibleTargetsCount:function(){return this.$container.find(this.selectors.target).filter(":visible").not(".addel-deleting").length},triggerAddEvent:function(e){var i=t.Event("addel:add",{target:e});return this.$container.trigger(i),i},triggerAddedEvent:function(e,i){this.$container.trigger(t.Event("addel:added",{target:e,added:i}))},triggerDeleteEvent:function(e){var i=t.Event("addel:delete",{target:e});return this.$container.trigger(i),i},triggerDeletedEvent:function(e){this.$container.trigger(t.Event("addel:deleted",{target:e}))}},t.fn[e]=function(n){return this.each(function(){t.data(this,"plugin_"+e)||t.data(this,"plugin_"+e,new i(this,n)).init()})},t.fn[e].defaults={hide:!1,add:1,classes:{target:"addel-target",add:"addel-add","delete":"addel-delete"},animation:{duration:0,easing:"swing"}}}(jQuery);